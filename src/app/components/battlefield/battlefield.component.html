<div class="col">
<button data-bs-toggle="modal" data-bs-target="#deckProcessorModal">
  Import Deck
</button>
  <button>
    Help
  </button>
  <button data-bs-toggle="modal" data-bs-target="#saveGameModal">
    Save / Load
  </button>
</div>
<!--modal-->
<div class="modal fade" id="deckProcessorModal" tabindex="-1" aria-labelledby="deckProcessorModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="z-index: 10">
      <div class="modal-header">
        <h5 class="modal-title" id="deckProcessorModalLabel">Import Deck</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <button>Save Deck loaded</button>
        <app-deck-processor></app-deck-processor>
      </div>
    </div>
  </div>
</div>

<div>
  <!--apartado para poner la linea temporal del turno-->
</div>

<!-- Contenedor principal fuera del modal -->
<div class="container mt-6">

  <div class="row">
    <div class="col">
      <app-stack></app-stack>
    </div>
    <div class="col-12 col-md-9 mb-4">
      <div class="ratio ratio-1x4" style=" height: 600px; background-color: #f4f4f4; border: 2px solid #ccc;">
        <div class="d-flex">

          <div class="battlefield-container">
            <!-- Fila 1: Criaturas y Batallas -->
          <div class="battlefield-row">
            @for (perm of creaturesRow | async; track trackByInstance) {
              <app-permanent-card
                [card]="perm"
                (cardAction)="handleCardAction($event)">
              </app-permanent-card>
            }
          </div>
            <!-- Fila 2: Artefactos, Encantamientos, Planeswalkers -->
            <div class="battlefield-row">
              @for (perm of allRow | async; track trackByInstance) {
                 <app-permanent-card
                   [card]="perm"
                   (cardAction)="handleCardAction($event)">
                  </app-permanent-card>
              }
            </div>
            <!-- Fila 3: Tierras -->
            <div class="battlefield-row">
              @for (perm of landsRow | async; track trackByInstance) {
                  <app-permanent-card
                    [card]="perm"
                    (cardAction)="handleCardAction($event)">
                  </app-permanent-card>
              }
            </div>
          </div>

        </div>

      </div>
    </div>

    @if (selectedCardForDetails && modalVisible) {
      <app-card-detail
        [card]="selectedCardForDetails"
        [visible]="modalVisible"
        (closed)="modalVisible = false">
      </app-card-detail>
    }

    <div class="col mt-4">

      @if (hasCommander) {
        <div class="col-12 col-md-3">
          <app-commander></app-commander>
        </div>
      }
      <div class="col-12 col-md-3">
        <app-library></app-library>
      </div>
      <br/>
      <div class="col-12 col-md-3">
        <app-graveyard></app-graveyard>
      </div>
    </div>
  </div>
</div>

<!-- Save Game Modal -->
<div class="modal fade" id="saveGameModal" tabindex="-1" aria-labelledby="saveGameModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content" style="z-index: 10">
      <div class="modal-header">
        <h5 class="modal-title" id="saveGameModalLabel">Save or Load Game</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <label for="saveNameInput" class="form-label">Save Name</label>
        <input id="saveNameInput" [(ngModel)]="saveName" class="form-control" placeholder="e.g., Turn 5 vs Rakdos" />

        <div class="mt-3">
          <strong>Saved Games</strong>
          <ul class="list-group mt-2">
            @for (game of savedGames; track $index) {
            <li
                (click)="selectSavedGame(game)"
                class="list-group-item list-group-item-action"
                [class.active]="selectedSaveId === game.id">
              {{ game.id }} <small class="text-muted">({{ game.date }})</small>
              <button class="btn btn-outline-danger" style="margin-left: 20px" (click)="deleteGame(game.id)" data-bs-dismiss="modal">
                X
              </button>
            </li>
            }
          </ul>
        </div>

        <div class="mt-3 d-flex justify-content-between">
          <button class="btn btn-success" [disabled]="!selectedSaveId" (click)="loadSelectedGame()" data-bs-dismiss="modal">
            Load Game
          </button>
          <button class="btn btn-primary" (click)="saveGame()" data-bs-dismiss="modal">
            {{ selectedSaveId === saveName ? 'Overwrite Save' : 'Save as New' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
